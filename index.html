<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>TszTung's Habits</title>
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='50' cy='50' r='50' fill='%23e2d0f9'/><circle cx='35' cy='50' r='20' fill='%235d576b'/><circle cx='65' cy='60' r='15' fill='white'/><path d='M60 45 L65 60 L70 45 Z' fill='white'/><path d='M35 40 Q45 40 50 60' stroke='white' stroke-width='3' fill='none'/></svg>">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3.4.19/dist/vue.global.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@500;700;900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg: #fdfbf7;
            --text: #5d576b;
            --pastel-green: #b7e4c7;
            --pastel-purple: #e2d0f9;
        }
        
        body { 
            font-family: 'Zen Maru Gothic', sans-serif; 
            background: var(--bg); 
            color: var(--text); 
            height: 100dvh; 
            width: 100vw;
            overflow: hidden; 
            -webkit-tap-highlight-color: transparent;
        }
        
        .glass { 
            background: rgba(255,255,255,0.85); 
            backdrop-filter: blur(12px); 
            border: 1px solid rgba(255,255,255,0.9); 
            border-radius: 24px; 
            box-shadow: 0 4px 20px rgba(0,0,0,0.03); 
            position: relative;
            z-index: 10;
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        
        .slide-up { animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        
        .scale-in { animation: scaleIn 0.2s cubic-bezier(0.34, 1.56, 0.64, 1); }
        @keyframes scaleIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        .sticker-bg {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            z-index: 0;
            overflow: hidden;
        }
        .bunny-sticker {
            position: absolute;
            opacity: 0.15;
            transition: transform 0.5s;
        }
        
        [v-cloak] { display: none; }
    </style>
</head>
<body>

<div id="app" v-cloak class="flex flex-col h-full max-w-md mx-auto relative bg-[#fdfbf7]">

    <div class="sticker-bg">
        <svg class="bunny-sticker" style="top: 5%; left: 5%; width: 60px; transform: rotate(-15deg);" viewBox="0 0 100 100">
            <path d="M30 40 Q25 10 40 30 Q50 40 60 30 Q75 10 70 40 Q90 50 90 70 Q90 90 50 90 Q10 90 10 70 Q10 50 30 40" fill="#e2d0f9"/>
            <circle cx="35" cy="55" r="3" fill="#5d576b"/><circle cx="65" cy="55" r="3" fill="#5d576b"/>
        </svg>
        <svg class="bunny-sticker" style="top: 15%; right: -10px; width: 80px; transform: rotate(20deg);" viewBox="0 0 100 100">
            <path d="M30 40 Q25 10 40 30 Q50 40 60 30 Q75 10 70 40 Q90 50 90 70 Q90 90 50 90 Q10 90 10 70 Q10 50 30 40" fill="#fbc4ab"/>
            <circle cx="35" cy="55" r="3" fill="#5d576b"/><circle cx="65" cy="55" r="3" fill="#5d576b"/>
        </svg>
        <svg class="bunny-sticker" style="bottom: 25%; left: -20px; width: 100px; transform: rotate(-10deg);" viewBox="0 0 100 100">
            <path d="M30 40 Q25 10 40 30 Q50 40 60 30 Q75 10 70 40 Q90 50 90 70 Q90 90 50 90 Q10 90 10 70 Q10 50 30 40" fill="#b7e4c7"/>
            <circle cx="35" cy="55" r="3" fill="#5d576b"/><circle cx="65" cy="55" r="3" fill="#5d576b"/>
        </svg>
        <svg class="bunny-sticker" style="bottom: 12%; right: 10%; width: 50px; transform: rotate(45deg);" viewBox="0 0 100 100">
            <path d="M30 40 Q25 10 40 30 Q50 40 60 30 Q75 10 70 40 Q90 50 90 70 Q90 90 50 90 Q10 90 10 70 Q10 50 30 40" fill="#99c1de"/>
            <circle cx="35" cy="55" r="3" fill="#5d576b"/><circle cx="65" cy="55" r="3" fill="#5d576b"/>
        </svg>
    </div>

    <div class="pt-12 px-6 pb-4 sticky top-0 bg-[#fdfbf7]/95 z-30 backdrop-blur-sm transition-all">
        <div class="flex justify-between items-center">
            <div>
                <h1 class="text-3xl font-black text-[#5d576b] tracking-tight">
                    {{ viewTitle }}
                </h1>
                <p class="text-xs font-bold opacity-40 uppercase tracking-widest mt-1">{{ todayLabel }}</p>
            </div>
            <div class="w-16 h-16 rounded-full border-[6px] border-gray-100 flex items-center justify-center relative shadow-sm bg-white">
                <span class="text-xs font-black">{{ todayProgress }}%</span>
                <svg class="absolute inset-0 w-full h-full -rotate-90 transform" viewBox="0 0 36 36">
                    <path :stroke-dasharray="todayProgress + ', 100'" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="#b7e4c7" stroke-width="4" stroke-linecap="round"/>
                </svg>
            </div>
        </div>
    </div>

    <main class="flex-1 overflow-y-auto px-5 pb-32 space-y-5 no-scrollbar relative z-10">
        
        <div v-if="view === 'today'" class="space-y-4 pt-2">
            
            <div v-for="h in habits" :key="h.id" class="glass p-5 relative overflow-hidden transition-all active:scale-[0.99]">
                <div class="flex items-center gap-4 mb-5">
                    <div class="w-12 h-12 rounded-2xl flex items-center justify-center text-xl shadow-sm text-white transition-colors" :style="{background: h.color}">
                        <i :class="h.icon"></i>
                    </div>
                    <div class="flex-1">
                        <div class="font-black text-lg text-[#5d576b] leading-none mb-1">{{ h.name }}</div>
                        <div class="text-xs font-bold opacity-40">Target: {{ h.target }} {{ h.unit }}</div>
                    </div>
                    <button @click="deleteHabit(h.id)" class="opacity-20 hover:opacity-100 p-2"><i class="fas fa-times text-xs"></i></button>
                </div>

                <div class="flex items-center justify-between gap-3 relative z-10">
                    <div class="flex-1 h-14 bg-white/80 rounded-2xl flex items-center justify-between px-1 shadow-sm border border-white relative">
                        <button @click="update(h, -1)" class="w-10 h-10 rounded-xl flex items-center justify-center text-gray-400 active:bg-gray-100 transition-colors"><i class="fas fa-minus"></i></button>
                        
                        <input type="number" 
                               v-model.number="logs[dateKey][h.id]" 
                               placeholder="0"
                               @focus="$event.target.select()"
                               class="w-full h-full bg-transparent text-center font-black text-2xl text-[#5d576b] outline-none placeholder-gray-200">
                        
                        <button @click="update(h, 1)" class="w-10 h-10 rounded-xl flex items-center justify-center text-[#5d576b] active:bg-gray-100 transition-colors"><i class="fas fa-plus"></i></button>
                    </div>

                    <button @click="complete(h)" 
                            class="w-14 h-14 rounded-2xl flex items-center justify-center shadow-md transition-all active:scale-90 border-2"
                            :class="isDone(h) ? 'bg-[#b7e4c7] border-[#b7e4c7] text-white scale-in' : 'bg-white border-white text-gray-200'">
                        <i class="fas fa-check text-xl"></i>
                    </button>
                </div>

                <div class="absolute bottom-0 left-0 h-1.5 bg-gray-100/50 w-full">
                    <div class="h-full transition-all duration-500 ease-out" 
                         :style="{width: Math.min(100, getPercent(h)) + '%', background: h.color}"></div>
                </div>
            </div>

            <div class="h-12"></div>
        </div>

        <div v-if="view === 'month'" class="space-y-6 pt-2">
            <div class="glass p-6">
                <div class="flex justify-between items-center mb-6">
                    <span class="font-black text-xl text-[#5d576b]">Calendar</span>
                </div>
                
                <div class="grid grid-cols-7 gap-3 mb-2">
                    <div v-for="d in ['S','M','T','W','T','F','S']" class="text-center text-[10px] font-bold opacity-30">{{d}}</div>
                    
                    <div v-for="day in 28" :key="day" 
                         class="aspect-square rounded-xl flex items-center justify-center text-xs font-bold border transition-all"
                         :class="getDayClass(day).cls"
                         :style="getDayClass(day).style">
                        {{ day }}
                    </div>
                </div>
                
                <div class="flex justify-center gap-4 text-[10px] font-bold opacity-50 mt-6">
                    <span class="flex items-center"><div class="w-3 h-3 bg-gray-100 rounded mr-1"></div> Empty</span>
                    <span class="flex items-center"><div class="w-3 h-3 bg-[#e2d0f9] rounded mr-1"></div> Done</span>
                    <span class="flex items-center"><div class="w-3 h-3 bg-[#b7e4c7] rounded mr-1"></div> Perfect</span>
                </div>
            </div>
        </div>

        <div v-if="view === 'review'" class="space-y-6 pt-2">
            
            <div class="glass p-6">
                <h3 class="font-black text-lg text-[#5d576b] mb-4 flex items-center">
                    <i class="fas fa-chart-bar mr-2 text-[#e2d0f9]"></i> This Week
                </h3>
                <div class="space-y-4">
                    <div v-for="day in thisWeek" :key="day.date" class="flex items-center justify-between">
                        <div class="flex flex-col w-24">
                            <span class="text-xs font-bold opacity-60 uppercase">{{ day.label }}</span>
                            <span v-if="day.surpassed" class="text-[9px] font-black text-[#b7e4c7] animate-pulse">ðŸ”¥ SURPASS</span>
                        </div>
                        
                        <div class="flex-1 h-3 bg-gray-100 rounded-full mx-3 overflow-hidden relative">
                            <div class="h-full bg-[#e2d0f9]" :style="{width: Math.min(100, day.percent) + '%'}"></div>
                            <div v-if="day.surpassed" class="absolute top-0 left-0 h-full bg-[#faedcb] mix-blend-multiply" style="width: 100%"></div>
                        </div>
                        <span class="text-xs font-black w-8 text-right">{{ day.score }}/{{ habits.length }}</span>
                    </div>
                </div>
            </div>

            <div class="glass p-6">
                <h3 class="font-black text-lg text-[#5d576b] mb-4 flex items-center">
                    <i class="fas fa-trophy mr-2 text-[#b7e4c7]"></i> Monthly Totals
                </h3>
                <div class="grid grid-cols-2 gap-3">
                    <div v-for="h in habits" :key="h.id" class="bg-white/60 p-3 rounded-2xl border border-white shadow-sm">
                        <div class="flex items-center gap-2 mb-2">
                            <div class="w-6 h-6 rounded-full flex items-center justify-center text-[10px] text-white" :style="{background: h.color}">
                                <i :class="h.icon"></i>
                            </div>
                            <span class="text-xs font-bold truncate">{{ h.name }}</span>
                        </div>
                        <div class="text-2xl font-black text-[#5d576b]">
                            {{ getMonthlyTotal(h) }}
                            <span class="text-[10px] font-bold opacity-40 ml-1">{{ h.unit }}</span>
                        </div>
                    </div>
                </div>
            </div>

        </div>

    </main>

    <nav class="fixed bottom-0 w-full bg-white/90 backdrop-blur-xl border-t border-gray-100 pb-8 pt-3 flex justify-around h-[90px] z-30">
        <button @click="view='today'" class="flex flex-col items-center w-16 transition-all active:scale-95" :class="view==='today'?'text-[#5d576b] scale-105':'text-gray-300'">
            <div class="text-2xl mb-1" :class="view==='today'?'drop-shadow-sm':''"><i class="fas fa-check-square"></i></div>
            <span class="text-[9px] font-bold tracking-widest">TODAY</span>
        </button>
        
        <button @click="view='month'" class="flex flex-col items-center w-16 transition-all active:scale-95" :class="view==='month'?'text-[#5d576b] scale-105':'text-gray-300'">
            <div class="text-2xl mb-1" :class="view==='month'?'drop-shadow-sm':''"><i class="fas fa-calendar-alt"></i></div>
            <span class="text-[9px] font-bold tracking-widest">MONTH</span>
        </button>

        <button @click="view='review'" class="flex flex-col items-center w-16 transition-all active:scale-95" :class="view==='review'?'text-[#5d576b] scale-105':'text-gray-300'">
            <div class="text-2xl mb-1" :class="view==='review'?'drop-shadow-sm':''"><i class="fas fa-chart-pie"></i></div>
            <span class="text-[9px] font-bold tracking-widest">REVIEW</span>
        </button>
    </nav>

    <button v-if="view === 'today'" 
            @click="showModal=true" 
            class="fixed bottom-28 right-6 w-16 h-16 bg-[#5d576b] text-white rounded-full shadow-xl flex items-center justify-center z-40 text-2xl active:scale-90 transition-transform border-4 border-white/50 backdrop-blur-sm">
        <i class="fas fa-plus"></i>
    </button>

    <div v-if="showModal" class="fixed inset-0 z-50 flex items-end justify-center">
        <div class="absolute inset-0 bg-black/20 backdrop-blur-sm transition-opacity" @click="showModal=false"></div>
        <div class="bg-white w-full max-w-md rounded-t-[32px] p-8 slide-up relative shadow-2xl pb-12">
            <div class="w-12 h-1 bg-gray-200 rounded-full mx-auto mb-6"></div>
            <h2 class="text-2xl font-black mb-6 text-[#5d576b]">Create Habit</h2>
            <div class="space-y-5">
                <div>
                    <label class="text-xs font-bold uppercase opacity-40 ml-1">Habit Name</label>
                    <input v-model="newH.name" placeholder="e.g. Read Book" class="w-full bg-gray-50 p-4 rounded-2xl font-bold outline-none text-lg text-[#5d576b] focus:ring-2 focus:ring-[#b7e4c7] transition-all">
                </div>
                <div class="flex gap-4">
                    <div class="w-1/3">
                        <label class="text-xs font-bold uppercase opacity-40 ml-1">Target</label>
                        <input v-model.number="newH.target" type="number" class="w-full bg-gray-50 p-4 rounded-2xl font-bold outline-none text-lg text-center focus:ring-2 focus:ring-[#b7e4c7]">
                    </div>
                    <div class="flex-1">
                        <label class="text-xs font-bold uppercase opacity-40 ml-1">Unit</label>
                        <input v-model="newH.unit" placeholder="mins/times" class="w-full bg-gray-50 p-4 rounded-2xl font-bold outline-none text-lg focus:ring-2 focus:ring-[#b7e4c7]">
                    </div>
                </div>
                <div>
                    <label class="text-xs font-bold uppercase opacity-40 ml-1 mb-2 block">Color</label>
                    <div class="flex gap-3 overflow-x-auto no-scrollbar py-1">
                        <div v-for="c in colors" :key="c" @click="newH.color=c" class="w-12 h-12 rounded-full cursor-pointer border-4 transition-transform hover:scale-110 shadow-sm flex-shrink-0" :style="{background:c, borderColor: newH.color===c?'#5d576b':'transparent'}"></div>
                    </div>
                </div>
                <div>
                    <label class="text-xs font-bold uppercase opacity-40 ml-1 mb-2 block">Icon</label>
                    <div class="flex gap-3 overflow-x-auto no-scrollbar py-1">
                        <div v-for="icon in allIcons" :key="icon" @click="newH.icon=icon" class="w-12 h-12 rounded-2xl cursor-pointer border-2 transition-transform hover:scale-110 shadow-sm flex-shrink-0 flex items-center justify-center" :style="{borderColor: newH.icon===icon?'#5d576b':'transparent'}">
                            <i :class="icon" class="text-xl text-[#5d576b]"></i>
                        </div>
                    </div>
                </div>
            </div>
            <button @click="addHabit" class="w-full bg-[#5d576b] text-white py-4 rounded-2xl font-bold text-lg mt-8 shadow-lg active:scale-95 transition-transform">Save Habit</button>
        </div>
    </div>

</div>

<script>
const { createApp, ref, computed, watch, onMounted } = Vue;

createApp({
    setup() {
        const view = ref('today');
        const showModal = ref(false);
        const dateKey = new Date().toISOString().split('T')[0];
        
        const logs = ref({ [dateKey]: {} });
        const habits = ref([
            { id: 1, name: "Drink Water", target: 5, unit: "bottles", color: "#ade8f4", icon: "fas fa-tint" },
            { id: 2, name: "Duolingo", target: 1, unit: "session", color: "#b7e4c7", icon: "fas fa-language" },
            { id: 3, name: "Plank 1min", target: 3, unit: "sets", color: "#ffc8dd", icon: "fas fa-stopwatch" },
            { id: 4, name: "Knee Lift", target: 100, unit: "reps", color: "#e2d0f9", icon: "fas fa-running" }
        ]);
        
        const newH = ref({ name:'', target:1, unit:'', color:'#ade8f4', icon:'fas fa-star' });
        const colors = ['#ade8f4', '#b7e4c7', '#ffc8dd', '#e2d0f9', '#fdf0d5', '#ff9aa2', '#a0c4ff'];
        const allIcons = [
            // Music
            'fas fa-music', 'fas fa-headphones', 'fas fa-guitar', 'fas fa-microphone', 'fas fa-drum',
            // Nature & Farming
            'fas fa-tree', 'fas fa-leaf', 'fas fa-seedling', 'fas fa-sun', 'fas fa-cloud-rain',
            // Sports
            'fas fa-basketball-ball', 'fas fa-futbol', 'fas fa-running', 'fas fa-swimmer', 'fas fa-dumbbell',
            // Original
            'fas fa-tint', 'fas fa-language', 'fas fa-stopwatch', 'fas fa-star'
        ];

        const update = (h, val) => {
            if(!logs.value[dateKey]) logs.value[dateKey] = {};
            const cur = logs.value[dateKey][h.id] || 0;
            logs.value[dateKey][h.id] = Math.max(0, cur + val);
        };

        const complete = (h) => {
            if(!logs.value[dateKey]) logs.value[dateKey] = {};
            const cur = logs.value[dateKey][h.id] || 0;
            if (cur >= h.target) {
                logs.value[dateKey][h.id] = 0;
            } else {
                logs.value[dateKey][h.id] = h.target;
            }
        };

        const addHabit = () => {
            if(newH.value.name) {
                habits.value.push({ ...newH.value, id: Date.now() });
                showModal.value = false;
                newH.value = { name:'', target:1, unit:'', color:'#ade8f4', icon:'fas fa-star' };
            }
        };

        const deleteHabit = (id) => {
            if(confirm("Delete this habit?")) {
                habits.value = habits.value.filter(h => h.id !== id);
            }
        };

        const isDone = (h) => (logs.value[dateKey]?.[h.id] || 0) >= h.target;
        const getPercent = (h) => {
            const val = logs.value[dateKey]?.[h.id] || 0;
            return (val / h.target) * 100;
        };
        
        const todayLabel = computed(() => new Date().toLocaleDateString('en-US', { weekday:'long', month:'short', day:'numeric' }));
        
        const viewTitle = computed(() => {
            if(view.value === 'today') return "TszTung's Habit";
            if(view.value === 'month') return "Calendar";
            return "Review";
        });

        const todayProgress = computed(() => {
            if(!habits.value.length) return 0;
            let doneCount = 0;
            habits.value.forEach(h => { if(isDone(h)) doneCount++; });
            return Math.round((doneCount / habits.value.length) * 100);
        });

        const getDayClass = (day) => {
            const dStr = `2026-02-${String(day).padStart(2,'0')}`;
            const todayNum = new Date().getDate();
            if(day > todayNum) return { cls: 'bg-gray-50 text-gray-200 border-transparent', style: {} };
            
            const dayLog = logs.value[dStr] || {};
            let done = 0;
            habits.value.forEach(h => {
                if((dayLog[h.id] || 0) >= h.target) done++;
            });
            
            if(done === 0) return { cls: 'bg-white border-gray-100 text-gray-300', style: {} };
            if(done === habits.value.length) return { cls: 'text-white border-[#b7e4c7] font-black', style: { background: '#b7e4c7' } };
            return { cls: 'text-white border-[#e2d0f9]', style: { background: '#e2d0f9' } };
        };

        const thisWeek = computed(() => {
            const today = new Date();
            const day = today.getDay();
            const diff = today.getDate() - day + (day === 0 ? -6 : 1);
            const monday = new Date(today.setDate(diff));

            const days = [];
            for (let i = 0; i < 7; i++) {
                const d = new Date(monday);
                d.setDate(monday.getDate() + i);
                const iso = d.toISOString().split('T')[0];
                const dayLog = logs.value[iso] || {};
                
                let score = 0;
                let surpassed = false;

                habits.value.forEach(h => {
                    const val = dayLog[h.id] || 0;
                    if (val >= h.target) score++;
                    if (val > h.target) surpassed = true;
                });

                days.push({
                    date: iso,
                    label: d.toLocaleDateString('en-US', { weekday: 'short' }),
                    score: score,
                    percent: (score / habits.value.length) * 100,
                    surpassed: surpassed
                });
            }
            return days;
        });

        const getMonthlyTotal = (h) => {
            let total = 0;
            Object.keys(logs.value).forEach(k => {
                if(k.startsWith('2026-02')) total += (logs.value[k][h.id] || 0);
            });
            return total;
        };

        onMounted(() => {
            const h = localStorage.getItem('habits_v6');
            const l = localStorage.getItem('logs_v6');
            if(h) habits.value = JSON.parse(h);
            if(l) logs.value = JSON.parse(l);
            if(!logs.value[dateKey]) logs.value[dateKey] = {};
        });

        watch([habits, logs], () => {
            localStorage.setItem('habits_v6', JSON.stringify(habits.value));
            localStorage.setItem('logs_v6', JSON.stringify(logs.value));
        }, { deep: true });

        return { 
            view, habits, logs, dateKey, showModal, newH, colors, allIcons,
            update, complete, addHabit, deleteHabit,
            isDone, getPercent, todayLabel, todayProgress, viewTitle,
            getDayClass, thisWeek, getMonthlyTotal
        };
    }
}).mount('#app');
</script>
</body>
</html>
