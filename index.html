<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RPG Workout Timer</title>
    <style>
        :root {
            --primary: #6366f1;
            --secondary: #ec4899;
            --bg: #0f172a;
            --card: #1e293b;
            --text: #f8fafc;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
        }

        .container {
            background-color: var(--card);
            padding: 2rem;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.5);
            width: 350px;
            text-align: center;
        }

        /* Level System Styles */
        .hud {
            margin-bottom: 20px;
            text-align: left;
        }

        .level-badge {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            padding: 5px 10px;
            border-radius: 8px;
            font-weight: bold;
            font-size: 0.9rem;
            display: inline-block;
            margin-bottom: 5px;
        }

        .xp-bar-container {
            width: 100%;
            height: 10px;
            background-color: #334155;
            border-radius: 5px;
            overflow: hidden;
        }

        .xp-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            width: 0%;
            transition: width 0.5s ease;
        }

        .xp-text {
            font-size: 0.8rem;
            color: #94a3b8;
            margin-top: 5px;
            display: block;
            text-align: right;
        }

        /* Timer Styles */
        .timer-display {
            font-size: 4rem;
            font-weight: 700;
            font-variant-numeric: tabular-nums;
            margin: 20px 0;
            color: var(--primary);
            text-shadow: 0 0 10px rgba(99, 102, 241, 0.3);
        }

        /* Inputs */
        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        input {
            background: #334155;
            border: none;
            color: white;
            padding: 10px;
            border-radius: 8px;
            width: 100%;
            font-size: 1rem;
        }

        input:focus {
            outline: 2px solid var(--primary);
        }

        /* Controls */
        .controls {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1rem;
            transition: transform 0.1s;
        }

        button:active {
            transform: scale(0.95);
        }

        .btn-start { background-color: var(--primary); color: white; flex: 2; }
        .btn-stop { background-color: #ef4444; color: white; display: none;}
        .btn-reset { background-color: #334155; color: white; flex: 1; }

        .message {
            height: 20px;
            margin-top: 15px;
            font-size: 0.9rem;
            color: var(--secondary);
        }

        /* Animation */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        .level-up-anim {
            animation: pulse 0.5s infinite;
            color: #fbbf24;
        }
    </style>
</head>
<body>

<div class="container">
    <div class="hud">
        <span class="level-badge" id="levelDisplay">Level 1</span>
        <div class="xp-bar-container">
            <div class="xp-bar-fill" id="xpBar"></div>
        </div>
        <span class="xp-text" id="xpText">0 / 100 XP</span>
    </div>

    <div class="input-group" id="setupArea">
        <input type="text" id="exerciseName" placeholder="Exercise (e.g. Plank)" value="Plank">
        <input type="number" id="durationInput" placeholder="Secs" value="60" min="1">
    </div>

    <div class="timer-display" id="timer">01:00</div>
    <div class="message" id="messageBox"></div>

    <div class="controls">
        <button class="btn-start" id="startBtn" onclick="startTimer()">START</button>
        <button class="btn-stop" id="stopBtn" onclick="stopTimer()">STOP</button>
        <button class="btn-reset" onclick="resetTimer()">RESET</button>
    </div>
</div>

<script>
    // --- STATE MANAGEMENT ---
    let timerInterval;
    let totalTime = 60;
    let timeLeft = 60;
    let isRunning = false;
    
    // Load from local storage or default to 0
    let player = JSON.parse(localStorage.getItem('workoutPlayer')) || {
        xp: 0,
        level: 1,
        xpToNextLevel: 100
    };

    // --- SOUND ENGINE ---
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playTone(freq, type, duration) {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = type;
        osc.frequency.value = freq;
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.start();
        gain.gain.exponentialRampToValueAtTime(0.00001, audioCtx.currentTime + duration);
        osc.stop(audioCtx.currentTime + duration);
    }

    // --- LEVEL SYSTEM LOGIC ---
    function updateHUD() {
        document.getElementById('levelDisplay').innerText = `Level ${player.level}`;
        document.getElementById('xpText').innerText = `${Math.floor(player.xp)} / ${player.xpToNextLevel} XP`;
        
        const percentage = (player.xp / player.xpToNextLevel) * 100;
        document.getElementById('xpBar').style.width = `${percentage}%`;
        
        // Save progress
        localStorage.setItem('workoutPlayer', JSON.stringify(player));
    }

    function addXP(amount) {
        player.xp += amount;
        
        // Check for Level Up
        if (player.xp >= player.xpToNextLevel) {
            player.level++;
            player.xp = player.xp - player.xpToNextLevel; // Carry over excess XP
            player.xpToNextLevel = Math.floor(player.xpToNextLevel * 1.5); // Harder to reach next level
            
            playTone(600, 'square', 0.1);
            setTimeout(() => playTone(800, 'square', 0.2), 150);
            
            const badge = document.getElementById('levelDisplay');
            badge.classList.add('level-up-anim');
            document.getElementById('messageBox').innerText = "LEVEL UP!";
            setTimeout(() => badge.classList.remove('level-up-anim'), 2000);
        }
        updateHUD();
    }

    // --- TIMER LOGIC ---
    function formatTime(seconds) {
        const m = Math.floor(seconds / 60).toString().padStart(2, '0');
        const s = (seconds % 60).toString().padStart(2, '0');
        return `${m}:${s}`;
    }

    function startTimer() {
        if (isRunning) return;

        // Get custom input values
        const inputSecs = parseInt(document.getElementById('durationInput').value);
        if(!inputSecs || inputSecs <= 0) return alert("Please enter valid seconds");
        
        // Lock inputs
        document.getElementById('setupArea').style.opacity = '0.5';
        document.getElementById('setupArea').style.pointerEvents = 'none';

        // Initialize if starting fresh
        if (timeLeft === totalTime || timeLeft === parseInt(document.getElementById('durationInput').value)) { 
            totalTime = inputSecs;
            timeLeft = inputSecs;
        }

        isRunning = true;
        document.getElementById('startBtn').style.display = 'none';
        document.getElementById('stopBtn').style.display = 'block';
        document.getElementById('messageBox').innerText = `Focus: ${document.getElementById('exerciseName').value}`;
        
        // Start beep
        playTone(440, 'sine', 0.1);

        timerInterval = setInterval(() => {
            timeLeft--;
            document.getElementById('timer').innerText = formatTime(timeLeft);

            if (timeLeft <= 0) {
                finishTimer();
            }
        }, 1000);
    }

    function stopTimer() {
        clearInterval(timerInterval);
        isRunning = false;
        document.getElementById('startBtn').style.display = 'block';
        document.getElementById('stopBtn').style.display = 'none';
        document.getElementById('startBtn').innerText = "RESUME";
    }

    function finishTimer() {
        clearInterval(timerInterval);
        isRunning = false;
        
        // Victory Sound
        playTone(523.25, 'triangle', 0.1);
        setTimeout(() => playTone(659.25, 'triangle', 0.1), 150);
        setTimeout(() => playTone(783.99, 'triangle', 0.4), 300);

        document.getElementById('timer').innerText = "DONE";
        document.getElementById('messageBox').innerText = `+${totalTime} XP Gained!`;
        
        addXP(totalTime);
        
        document.getElementById('startBtn').style.display = 'block';
        document.getElementById('stopBtn').style.display = 'none';
        document.getElementById('startBtn').innerText = "START";
        
        // Unlock inputs
        document.getElementById('setupArea').style.opacity = '1';
        document.getElementById('setupArea').style.pointerEvents = 'auto';
        
        // Reset time for next round
        timeLeft = parseInt(document.getElementById('durationInput').value);
    }

    function resetTimer() {
        clearInterval(timerInterval);
        isRunning = false;
        const inputSecs = parseInt(document.getElementById('durationInput').value) || 60;
        timeLeft = inputSecs;
        totalTime = inputSecs;
        
        document.getElementById('timer').innerText = formatTime(timeLeft);
        document.getElementById('startBtn').style.display = 'block';
        document.getElementById('stopBtn').style.display = 'none';
        document.getElementById('startBtn').innerText = "START";
        document.getElementById('messageBox').innerText = "";
        
        document.getElementById('setupArea').style.opacity = '1';
        document.getElementById('setupArea').style.pointerEvents = 'auto';
    }

    // Initialize
    updateHUD();
    document.getElementById('durationInput').addEventListener('change', resetTimer);
</script>

</body>
</html>
